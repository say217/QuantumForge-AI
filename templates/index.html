<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>xAI Quant Desk</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            background: #000; 
            color: #fff; 
            margin: 0; 
            padding: 0; 
            height: 100vh;
        }
        #chat-container { 
            max-width: 800px; 
            margin: 0 auto; 
            height: 100vh; 
            display: flex; 
            flex-direction: column; 
        }
        #messages { 
            flex: 1; 
            overflow-y: auto; 
            padding: 20px; 
            background: #000;
        }
        .message { 
            margin-bottom: 20px; 
            display: flex;
        }
        .user { 
            justify-content: flex-end; 
        }
        .ai { 
            justify-content: flex-start; 
        }
        .message-content { 
            max-width: 70%; 
            padding: 12px 16px; 
            border-radius: 18px; 
            line-height: 1.4;
        }
        .user .message-content { 
            background: #1d9bf0; 
            color: white; 
        }
        .ai .message-content { 
            background: #202225; 
            color: #dcddde; 
            border-bottom-left-radius: 4px;
        }
        #input-container { 
            padding: 16px 20px; 
            border-top: 1px solid #333; 
            background: #000;
            display: flex;
            align-items: center;
        }
        #user-input { 
            flex: 1; 
            padding: 12px 16px; 
            background: #333; 
            color: white; 
            border: none; 
            border-radius: 20px; 
            margin-right: 10px;
        }
        #send-btn { 
            background: #1d9bf0; 
            color: white; 
            border: none; 
            padding: 12px 16px; 
            border-radius: 20px; 
            cursor: pointer; 
        }
        .markdown img { 
            max-width: 100%; 
            height: auto; 
            border-radius: 8px;
            margin: 10px 0;
        }
        .markdown h1, .markdown h2, .markdown h3 { 
            color: #fff; 
            border-bottom: 1px solid #333;
        }
        .markdown code { 
            background: #333; 
            padding: 2px 4px; 
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div id="chat-container">
        <div id="messages">
            <div class="message ai">
                <div class="message-content markdown">
                    <strong>xAI Quant Desk</strong> â€” YOUR PERSONAL STOCK ADVISOR<br>
                    GRU Model + Gemini Analysis<br><br>
                    Hello! I'm your AI Economic Expert and Stock Market Assistant.<br>
                    I can predict stock prices, generate reports, discuss markets, and share current news.<br>
                    Just say something like: 'predict Apple', 'what about Tesla', 'run NVDA forecast'.<br>
                    For general questions: 'What's the latest on tech stocks?' or 'exit' to quit.
                </div>
            </div>
        </div>
        <div id="input-container">
            <input type="text" id="user-input" placeholder="Type your message..." onkeypress="if(event.key==='Enter') sendMessage();">
            <button id="send-btn" onclick="sendMessage()">Send</button>
        </div>
    </div>
    <script>
        function addMessage(content, isUser) {
            const messages = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'ai'}`;
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content markdown';
            if (isUser) {
                contentDiv.textContent = content;
            } else {
                contentDiv.innerHTML = marked.parse(content);
            }
            messageDiv.appendChild(contentDiv);
            messages.appendChild(messageDiv);
            messages.scrollTop = messages.scrollHeight;
        }

        function sendMessage() {
            const input = document.getElementById('user-input');
            const message = input.value.trim();
            if (!message) return;
            addMessage(message, true);
            input.value = '';
            fetch('/chat', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({message: message})
            })
            .then(response => response.json())
            .then(data => {
                addMessage(data.response, false);
            })
            .catch(error => {
                addMessage('Error: ' + error, false);
            });
        }
    </script>
</body>
</html>